<% notifications ||= [] %>
<div class="pointer-events-auto absolute right-6 top-[4.5rem] w-full max-w-sm overflow-hidden rounded-3xl border border-white/15 bg-white/95 p-4 text-sm shadow-soft backdrop-blur dark:border-white/10 dark:bg-surface-800/95">
  <div class="flex items-center justify-between">
    <div class="flex flex-col gap-1">
      <span class="text-xs uppercase tracking-wide text-ink-400 dark:text-slate-400">Notificações</span>
      <span class="text-base font-semibold text-ink-900 dark:text-white">Movimentos recentes</span>
    </div>
    <span class="rounded-full bg-primary-500/15 px-3 py-1 text-xs font-semibold text-primary-600 dark:bg-primary-500/20 dark:text-primary-200">Beta</span>
  </div>
  <div class="mt-4 flex flex-col gap-3">
    <% if notifications.any? %>
      <% notifications.each do |notification| %>
        <% badge_classes, icon = case notification.kind.to_sym
          when :critical
            ["bg-danger/10 text-danger dark:bg-danger/20 dark:text-danger", "critical"]
          when :low
            ["bg-warning/10 text-warning dark:bg-warning/20 dark:text-warning", "warning"]
          when :expiration
            ["bg-candy-lemon/70 text-ink-700 dark:bg-candy-lemon/30 dark:text-slate-900", "calendar"]
          else
            ["bg-primary-500/10 text-primary-600 dark:bg-primary-500/20 dark:text-primary-200", "bell"]
        end %>
        <div class="flex items-start gap-3 rounded-2xl p-3 <%= badge_classes %>">
          <span class="mt-1 inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/70 text-base dark:bg-white/10">
            <% case icon
              when "critical" %>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                <path d="M12 9v4" />
                <path d="M12 17h.01" />
                <path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
              </svg>
            <% when "warning" %>
              <span class="font-semibold">!</span>
            <% when "calendar" %>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                <path d="M8 2v4" />
                <path d="M16 2v4" />
                <path d="M3 9h18" />
                <path d="M5 5h14a2 2 0 012 2v12a2 2 0 01-2 2H5a2 2 0 01-2-2V7a2 2 0 012-2z" />
                <path d="M16 13h-4v4" />
              </svg>
            <% else %>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
                <path d="M15 17h5l-1.405-4.215A2 2 0 0016.69 11H5" />
                <circle cx="12" cy="19" r="2" />
                <circle cx="7" cy="19" r="2" />
              </svg>
            <% end %>
          </span>
          <div class="flex flex-col gap-1">
            <span class="text-sm font-semibold"><%= notification.title %></span>
            <% if notification.body.present? %>
              <p class="text-xs text-ink-500 dark:text-slate-300"><%= notification.body %></p>
            <% end %>
            <span class="text-[0.7rem] text-ink-400 dark:text-slate-500"><%= time_ago_in_words(notification.triggered_at) %> atrás</span>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="flex flex-col items-center gap-2 rounded-2xl bg-surface-50 p-4 text-center text-xs text-ink-400 dark:bg-white/5 dark:text-slate-400">
        <span class="text-2xl">✨</span>
        <p>Tudo em dia! Nenhuma notificação recente.</p>
      </div>
    <% end %>
  </div>
  <div class="mt-4 flex items-center justify-between text-xs text-ink-400 dark:text-slate-400">
    <%= button_to mark_all_family_notifications_path,
                  method: :patch,
                  class: "inline-flex items-center gap-1 rounded-full bg-primary-500/15 px-3 py-1 font-semibold text-primary-600 transition hover:bg-primary-500/25 hover:text-primary-700 dark:bg-primary-500/10 dark:text-primary-200",
                  data: { turbo_action: 'replace' } do %>
      Marcar todas como lidas
    <% end %>
    <a href="#" class="inline-flex items-center gap-1 text-ink-400 transition hover:text-ink-600 dark:hover:text-white">
      Ver histórico
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3">
        <path d="M9 18l6-6-6-6" />
      </svg>
    </a>
  </div>
</div>
