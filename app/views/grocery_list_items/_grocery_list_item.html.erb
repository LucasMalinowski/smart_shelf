<% inventory = inventory_lookup[grocery_list_item.item_id] if defined?(inventory_lookup) %>
<% steps = inventory ? BigDecimal(inventory.custom_unit_step.to_s) : BigDecimal(1) %>
<% current_quantity = BigDecimal(grocery_list_item.quantity.to_s) %>
<% decreased_value = current_quantity - steps <= 0 ? steps : current_quantity - steps %>
<% increased_value = current_quantity + steps %>
<turbo-frame id="grocery_list_item_<%= grocery_list_item.id %>">
  <div class="flex flex-col gap-4 rounded-3xl border border-white/15 bg-white/80 p-5 shadow-soft transition hover:-translate-y-0.5 hover:shadow-xl dark:border-white/10 dark:bg-surface-800/80 md:flex-row md:items-center md:justify-between">
    <div class="flex flex-col gap-1">
      <span class="text-sm font-semibold text-ink-900 dark:text-white"><%= grocery_list_item.item.name %></span>
      <span class="text-xs text-ink-400 dark:text-slate-400"><%= grocery_list_item.item.category.name %></span>
      <% if inventory %>
        <span class="text-xs text-ink-400 dark:text-slate-500">Estoque atual: <strong class="text-ink-600 dark:text-slate-200"><%= format_quantity(inventory) %></strong></span>
      <% end %>
    </div>
    <div class="flex items-center gap-3">
      <%= button_to '-',
            grocery_list_item_path(grocery_list_item),
            method: :put,
            params: { quantity: decreased_value.to_s("F") },
            class: "inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-ink-200/70 text-lg font-semibold text-ink-600 transition hover:-translate-y-0.5 hover:border-primary-300 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-200 dark:border-white/10 dark:text-slate-200 dark:hover:border-primary-400 dark:hover:text-primary-200",
            data: { turbo_action: 'replace' } %>
      <span class="min-w-[5rem] text-center text-lg font-semibold text-ink-900 dark:text-white">
        <% if inventory %>
          <%= format_measurement(current_quantity, inventory) %>
        <% else %>
          <%= number_with_precision(current_quantity, precision: 0) %> un
        <% end %>
      </span>
      <%= button_to '+',
            grocery_list_item_path(grocery_list_item),
            method: :put,
            params: { quantity: increased_value.to_s("F") },
            class: "inline-flex h-10 w-10 items-center justify-center rounded-2xl border border-primary-300 bg-primary-500 text-lg font-semibold text-white transition hover:-translate-y-0.5 hover:bg-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-300",
            data: { turbo_action: 'replace' } %>
      <%= button_to 'Remover',
            grocery_list_item_path(grocery_list_item),
            method: :delete,
            class: "inline-flex items-center gap-2 rounded-2xl border border-danger/40 px-4 py-2 text-xs font-semibold text-danger transition hover:-translate-y-0.5 hover:border-danger hover:text-danger focus:outline-none focus:ring-2 focus:ring-danger/40 dark:border-danger/40",
            data: { turbo_action: 'replace' } %>
    </div>
  </div>
</turbo-frame>
