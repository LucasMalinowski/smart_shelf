<div class="space-y-10" data-controller="filter" data-filter-selected-value="<%= @selected_category %>">
  <header class="flex flex-col gap-6 rounded-3xl bg-white/60 p-6 shadow-soft backdrop-blur dark:bg-surface-800/70 lg:flex-row lg:items-center lg:justify-between">
    <div class="flex flex-col gap-2">
      <div class="inline-flex items-center gap-2 text-xs font-semibold uppercase tracking-[0.4em] text-ink-400 dark:text-slate-400">
        Painel da despensa
      </div>
      <h1 class="text-3xl font-semibold text-ink-900 dark:text-white">Meus itens</h1>
      <p class="text-sm text-ink-500 dark:text-slate-300">Controle de estoque para toda a família, com alertas, compras sugeridas e experiências conectadas.</p>
      <div class="flex items-center gap-2 text-xs text-ink-400 dark:text-slate-500">
        <span>Exibindo</span>
        <%= render "items/loaded_counter", count: @loaded_count %>
        <span>itens</span>
      </div>
    </div>

    <div class="flex flex-col gap-3 sm:flex-row sm:items-center">
      <button class="inline-flex items-center justify-center gap-2 rounded-full border border-ink-200/60 px-5 py-2 text-sm font-semibold text-ink-600 transition hover:border-primary-300 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-200 dark:border-white/10 dark:text-slate-200 dark:hover:border-primary-400 dark:hover:text-primary-200 lg:hidden" data-action="click->filter#toggleSidebar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
          <path d="M3 4h18" />
          <path d="M8 9h8" />
          <path d="M10 14h4" />
          <path d="M12 19h0" />
        </svg>
        Filtros
      </button>

      <% current_direction = params[:sort_direction] == 'desc' ? 'desc' : 'asc' %>
      <% next_direction = current_direction == 'asc' ? 'desc' : 'asc' %>
      <%= link_to request.query_parameters.merge(sort_by: 'quantity', sort_direction: next_direction), class: "inline-flex items-center justify-center gap-2 rounded-full border border-ink-200/60 px-5 py-2 text-sm font-semibold text-ink-600 transition hover:border-primary-300 hover:text-primary-600 focus:outline-none focus:ring-2 focus:ring-primary-200 dark:border-white/10 dark:text-slate-200 dark:hover:border-primary-400 dark:hover:text-primary-200" do %>
        Ordenar por quantidade
        <span class="text-xs"><%= current_direction == 'asc' ? '↑' : '↓' %></span>
      <% end %>

      <%= link_to grocery_list_path, class: "inline-flex items-center justify-center gap-2 rounded-full bg-primary-600 px-6 py-3 text-sm font-semibold text-white shadow-soft transition hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-300 focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-surface-900" do %>
        <span>Lista de compras</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
          <path d="M7 4h-2l-1 7h16l-1-7h-2" />
          <path d="M10 11v6" />
          <path d="M14 11v6" />
          <path d="M5 21h14" />
        </svg>
      <% end %>
    </div>
  </header>

  <div class="flex flex-col gap-6 lg:flex-row">
    <aside class="hidden w-full max-w-xs flex-shrink-0 flex-col space-y-4 rounded-3xl border border-white/20 bg-white/70 p-4 shadow-soft dark:border-white/10 dark:bg-surface-800/80 lg:flex">
      <div class="flex items-center justify-between">
        <div class="flex flex-col gap-1">
          <span class="text-xs font-semibold uppercase tracking-[0.3em] text-ink-400 dark:text-slate-400">Categorias</span>
          <p class="text-sm text-ink-600 dark:text-slate-200">Filtre por setor ou visualize tudo</p>
        </div>
      </div>
      <div class="h-[70vh] space-y-2 overflow-y-auto pr-2">
        <%= render "items/filter_option", label: "Todas as categorias", value: "all", icon: "🧺", active: @selected_category == 'all' %>
        <% @categories.each do |category| %>
          <%= render "items/filter_option", label: category.name, value: category.id, icon: category_icon(category), active: @selected_category == category.id.to_s %>
        <% end %>
      </div>
    </aside>

    <section class="flex-1 space-y-10">
      <div id="inventory_items" class="space-y-10">
        <% if @inventory_items_by_category.present? %>
          <% @inventory_items_by_category.each do |category, items| %>
            <%= render "items/category_section", category: category, items: items %>
          <% end %>
        <% else %>
          <div class="flex flex-col items-center justify-center gap-3 rounded-3xl border border-dashed border-ink-200/60 bg-white/60 p-10 text-center text-sm text-ink-400 dark:border-white/10 dark:bg-surface-800/60 dark:text-slate-400">
            <span class="text-3xl">🗂️</span>
            <p>Nenhum item encontrado para este filtro.</p>
          </div>
        <% end %>
      </div>

      <%= render "items/pagination", next_page: @next_page, request_params: request.query_parameters %>
    </section>
  </div>

  <div class="fixed inset-0 z-20 hidden bg-surface-900/60 backdrop-blur lg:hidden" data-action="click->filter#closeSidebar" data-filter-target="backdrop"></div>

  <aside class="fixed inset-y-0 left-0 z-30 hidden w-80 max-w-full space-y-4 overflow-y-auto border-r border-white/10 bg-surface-900/95 p-4 shadow-soft lg:hidden" data-filter-target="sidebar">
    <div class="flex items-center justify-between">
      <h2 class="text-sm font-semibold text-white">Filtrar categorias</h2>
      <button class="inline-flex h-9 w-9 items-center justify-center rounded-xl border border-white/20 text-white" data-action="click->filter#closeSidebar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
          <path d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>

    <div class="mt-4 space-y-2">
      <%= render "items/filter_option", label: "Todas as categorias", value: "all", icon: "🧺", active: @selected_category == 'all', mobile: true %>
      <% @categories.each do |category| %>
        <%= render "items/filter_option", label: category.name, value: category.id, icon: category_icon(category), active: @selected_category == category.id.to_s, mobile: true %>
      <% end %>
    </div>
  </aside>
</div>
